<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rompecabezas deslizante - PEMSAM</title>
  <style>
    :root{ --azul:#03658C; --amarillo:#F2B705; --rojo:#F20505; --verde:#2ecc71; --gris:#e9eef5 }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,'Noto Sans',sans-serif;background:#f7fbff;color:#024}
    .wrap{max-width:980px;margin:0 auto;padding:16px}
    .panel{background:#fff;border:3px solid var(--azul);border-radius:16px;box-shadow:0 16px 36px rgba(0,0,0,.12);padding:16px}
    h1{margin:0 0 8px 0;color:var(--azul)}
    p{margin:0 0 8px 0;color:#345}
    .score{font-weight:800;color:#024e73;margin:8px 0}
    .grid{width:360px;height:360px;border:2px solid var(--azul);border-radius:12px;display:grid;grid-template-columns:repeat(3,1fr);grid-template-rows:repeat(3,1fr);gap:6px;background:var(--gris);margin:12px auto;padding:6px}
    .tile{background:#fff;border:2px solid #024e73;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:2rem;font-weight:800;color:#024e73;cursor:pointer;transition:transform .08s ease, box-shadow .2s ease;box-shadow:0 8px 18px rgba(0,0,0,.08)}
    .tile:active{transform:scale(0.98)}
    .tile.empty{background:transparent;border:2px dashed #aac;box-shadow:none;cursor:default}
    .controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center;justify-content:center;margin-top:8px}
    .btn{border:2px solid var(--azul);background:var(--azul);color:#fff;border-radius:10px;padding:8px 12px;font-weight:700;cursor:pointer}
    .btn:hover{background:var(--amarillo);color:var(--azul)}
    .ok{color:var(--verde);font-weight:800}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="panel">
      <h1>Rompecabezas deslizante</h1>
      <p>Ordena las piezas del 1 al 8. Solo puedes mover piezas adyacentes al espacio vacío.</p>
      <div class="score">Movimientos: <span id="moves">0</span> | Tiempo: <span id="time">0</span>s</div>
      <div id="grid" class="grid" aria-label="Tablero del rompecabezas"></div>
      <div id="message" class="ok" aria-live="polite"></div>
      <div class="controls">
        <button id="shuffle" class="btn">Mezclar</button>
        <button id="restart" class="btn">Reiniciar</button>
      </div>
    </div>
  </div>

  <script>
  (function(){
    const gridEl = document.getElementById('grid');
    const movesEl = document.getElementById('moves');
    const timeEl = document.getElementById('time');
    const msgEl = document.getElementById('message');
    const btnShuffle = document.getElementById('shuffle');
    const btnRestart = document.getElementById('restart');

    let tiles = []; // 0 representa el vacío
    let moves = 0; let secs = 0; let timer = null;

    function startTimer(){
      stopTimer();
      secs = 0; timeEl.textContent = '0';
      timer = setInterval(()=>{ secs++; timeEl.textContent = String(secs); }, 1000);
    }
    function stopTimer(){ if (timer) { clearInterval(timer); timer = null; } }

    function draw(){
      gridEl.innerHTML = '';
      tiles.forEach((n, idx)=>{
        const div = document.createElement('div');
        div.className = 'tile' + (n === 0 ? ' empty' : '');
        if (n !== 0) div.textContent = n;
        div.dataset.index = String(idx);
        div.addEventListener('click', ()=> tryMove(idx));
        gridEl.appendChild(div);
      });
    }

    function indexToRC(i){ return { r: Math.floor(i/3), c: i%3 }; }
    function rcToIndex(r,c){ return r*3 + c; }

    function findEmpty(){ return tiles.indexOf(0); }

    function canSwap(i, j){
      const a = indexToRC(i), b = indexToRC(j);
      const dr = Math.abs(a.r - b.r), dc = Math.abs(a.c - b.c);
      return (dr + dc) === 1; // adyacentes
    }

    function tryMove(i){
      const empty = findEmpty();
      if (canSwap(i, empty)){
        [tiles[i], tiles[empty]] = [tiles[empty], tiles[i]];
        moves++; movesEl.textContent = String(moves);
        draw();
        checkWin();
      }
    }

    function isSolvable(arr){
      // Para 3x3, solvable si número de inversiones es par
      const a = arr.filter(n=>n!==0);
      let inv = 0;
      for (let i=0;i<a.length;i++){
        for (let j=i+1;j<a.length;j++){
          if (a[i] > a[j]) inv++;
        }
      }
      return inv % 2 === 0;
    }

    function shuffle(){
      do {
        tiles = [1,2,3,4,5,6,7,8,0].sort(()=> Math.random() - 0.5);
      } while(!isSolvable(tiles));
      moves = 0; movesEl.textContent = '0'; msgEl.textContent = '';
      draw();
      startTimer();
    }

    function checkWin(){
      const win = tiles.every((n, i)=> n === (i+1) || (i === 8 && n === 0));
      if (win){
        stopTimer();
        msgEl.textContent = `¡Listo! Resuelto en ${moves} movimientos y ${secs} segundos.`;
      }
    }

    function restart(){ tiles = [1,2,3,4,5,6,7,8,0]; moves = 0; movesEl.textContent = '0'; msgEl.textContent = ''; draw(); stopTimer(); timeEl.textContent = '0'; }

    btnShuffle.addEventListener('click', shuffle);
    btnRestart.addEventListener('click', restart);

    // Init en orden y esperar al usuario para mezclar
    restart();
  })();
  </script>
</body>
</html>